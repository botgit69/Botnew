const { setIntervalAsync } = require("set-interval-async/dynamic");
const moment = require("moment-timezone");

module.exports = {
	config: {
		name: "hourly_islamic_ayat",
		version: "1.0",
		author: "Tanu Bruh",
		category: "events",
		description: "ржкрзНрж░рждрж┐ ржШржирзНржЯрж╛ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ ржЗрж╕рж▓рж╛ржорж┐ржХ ржмрж╛рж░рзНрждрж╛ + рж╕ржоржпрж╝ + ржЖржпрж╝рж╛ржд ржкрж╛ржарж╛ржмрзЗ"
	},

	onLoad: function({ api }) {
		console.log("ЁЯХМ Hourly Islamic Ayat Event Loaded Successfully!");

		setIntervalAsync(async () => {
			const now = moment().tz("Asia/Dhaka");
			const hour = now.hour();
			const minute = now.minute();
			const timeStr = now.format("HH:mm");

			// ржкрзНрж░рждрж┐ ржШржирзНржЯрж╛ржпрж╝ ржПржХржмрж╛рж░ (ржорж┐ржирж┐ржЯ 0 ржП)
			if (minute === 0) {
				// ржЗрж╕рж▓рж╛ржорж┐ржХ ржЖржпрж╝рж╛рждрзЗрж░ рждрж╛рж▓рж┐ржХрж╛ (ржХрж┐ржЫрзБ ржЙржжрж╛рж╣рж░ржг)
				const ayats = [
					{ ayat: "┘И┘О╪з┘Д┘С┘О╪░┘Р┘К┘Ж┘О ╪в┘Е┘О┘Ж┘П┘И╪з ┘И┘О╪╣┘О┘Е┘Р┘Д┘П┘И╪з ╪з┘Д╪╡┘С┘О╪з┘Д┘Р╪н┘О╪з╪к┘Р", meaning: "ржЖрж░ ржпрж╛рж░рж╛ ржИржорж╛ржи ржПржирзЗржЫрзЗ ржПржмржВ рж╕рзОржХрж╛ржЬ ржХрж░рзЗржЫрзЗред" },
					{ ayat: "╪е┘Р┘Ж┘С┘О ╪з┘Д┘Д┘С┘З┘О ┘Е┘О╪╣┘О ╪з┘Д╪╡┘С┘О╪з╪и┘Р╪▒┘Р┘К┘Ж┘О", meaning: "ржирж┐рж╢рзНржЪржпрж╝ржЗ ржЖрж▓рзНрж▓рж╛рж╣ ржзрзИрж░рзНржпрж╢рзАрж▓ржжрзЗрж░ рж╕ржЩрзНржЧрзЗ ржЖржЫрзЗржиред" },
					{ ayat: "┘Б┘О╪з╪░┘Т┘Г┘П╪▒┘П┘И┘Ж┘Р┘К ╪г┘О╪░┘Т┘Г┘П╪▒┘Т┘Г┘П┘Е┘Т", meaning: "рждрж╛рж╣рж▓рзЗ ржЖржорж╛ржХрзЗ рж╕рзНржорж░ржг ржХрж░рзЛ, ржЖржорж┐ рждрзЛржорж╛ржжрзЗрж░ рж╕рзНржорж░ржг ржХрж░ржмрзЛред" },
					{ ayat: "┘И┘О╪з╪╣┘Т╪и┘П╪п┘П┘И╪з ╪з┘Д┘Д┘С┘О┘З┘О ┘И┘О┘Д┘О╪з ╪к┘П╪┤┘Т╪▒┘Р┘Г┘П┘И╪з ╪и┘Р┘З┘Р ╪┤┘О┘К┘Т╪ж┘Л╪з", meaning: "ржЖрж▓рзНрж▓рж╛рж╣рж░ ржЙржкрж╛рж╕ржирж╛ ржХрж░ ржПржмржВ рждрж╛рж░ рж╕ржЩрзНржЧрзЗ ржХрж╛ржЙржХрзЗ ржЕржВрж╢рзАржжрж╛рж░ ржХрж░рзЛ ржирж╛ред" },
					{ ayat: "╪▒┘О╪и┘С┘Р ╪г┘О┘И┘Т╪▓┘Р╪╣┘Т┘Ж┘Р┘К ╪г┘О┘Ж┘Т ╪г┘О╪┤┘Т┘Г┘П╪▒┘О ┘Ж┘Р╪╣┘Т┘Е┘О╪к┘О┘Г┘О", meaning: "рж╣рзЗ ржЖржорж╛рж░ ржкрж╛рж▓ржиржХрж░рзНрждрж╛! ржЖржорж╛ржХрзЗ рждрзЛржорж╛рж░ ржирзЗржпрж╝рж╛ржорждрзЗрж░ ржЬржирзНржп ржХрзГрждржЬрзНржЮ рж╣рждрзЗ ржкрзНрж░рзЗрж░ржгрж╛ ржжрж╛ржУред" }
				];

				// рж░рзНржпрж╛ржирзНржбржо ржЖржпрж╝рж╛ржд ржирж┐рж░рзНржмрж╛ржЪржи
				const selected = ayats[Math.floor(Math.random() * ayats.length)];

				const message = `
ЁЯХМ ржЖрж╕рж╕рж╛рж▓рж╛ржорзБ ржЖрж▓рж╛ржЗржХрзБржо ржмржирзНржзрзБрж░рж╛!  
тП░ ржПржЦржи рж╕ржоржпрж╝: *${timeStr}* (Bangladesh Time)  

ЁЯУЦ ржЗрж╕рж▓рж╛ржорж┐ржХ ржЖржпрж╝рж╛ржд: "${selected.ayat}"  
ЁЯУЭ ржЕрж░рзНрже: "${selected.meaning}"  

ЁЯд▓ ржЖрж▓рзНрж▓рж╛рж╣ ржЖржорж╛ржжрзЗрж░ ржЬрзАржмржиржХрзЗ ржирзЗржХ ржЖржорж▓, рж╢рж╛ржирзНрждрж┐ ржПржмржВ рж░рж╣ржоржд ржжрж┐ржпрж╝рзЗ ржнрж░рзЗ ржжрж┐ржиред
`;

				try {
					const threads = await api.getThreadList(100, null, ["INBOX"]);
					for (const thread of threads) {
						await api.sendMessage(message, thread.threadID);
					}
					console.log(`тЬЕ Hourly Islamic message sent at ${timeStr} Bangladesh Time!`);
				} catch (err) {
					console.error("тЭМ Error sending hourly Islamic message:", err);
				}
			}
		}, 60 * 1000); // ржкрзНрж░рждрж┐ ржорж┐ржирж┐ржЯрзЗ ржЪрзЗржХ ржХрж░ржмрзЗ
	}
};
